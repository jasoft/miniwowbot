# æ¨¡æ‹Ÿå™¨è®¾å¤‡æ£€æŸ¥åŠŸèƒ½

## åŠŸèƒ½æ¦‚è¿°

ä¸º `auto_dungeon.py` æ·»åŠ äº†æ¨¡æ‹Ÿå™¨è®¾å¤‡åˆ—è¡¨æ£€æŸ¥åŠŸèƒ½ï¼Œåœ¨æŒ‡å®šæ¨¡æ‹Ÿå™¨ä¸å­˜åœ¨æ—¶ç«‹å³æŠ¥é”™å¹¶å‘é€ Bark é€šçŸ¥ã€‚

## å·¥ä½œåŸç†

### æ£€æŸ¥æµç¨‹

1. **è·å–è®¾å¤‡åˆ—è¡¨**
    - è°ƒç”¨ `EmulatorManager.get_adb_devices()` è·å–æ‰€æœ‰å·²è¿æ¥çš„ ADB è®¾å¤‡
    - è¿”å›æ ¼å¼ï¼š`{device_name: status}` å­—å…¸

2. **éªŒè¯æ¨¡æ‹Ÿå™¨å­˜åœ¨**
    - æ£€æŸ¥æŒ‡å®šçš„ `emulator_name` æ˜¯å¦åœ¨è®¾å¤‡åˆ—è¡¨ä¸­
    - å¦‚æœä¸å­˜åœ¨ï¼Œç«‹å³æŠ¥é”™å¹¶é€€å‡º

3. **å‘é€é€šçŸ¥**
    - ä½¿ç”¨ `send_notification()` å‘é€ Bark é€šçŸ¥
    - é€šçŸ¥çº§åˆ«è®¾ç½®ä¸º `timeSensitive`ï¼ˆç´§æ€¥ï¼‰
    - é€šçŸ¥å†…å®¹åŒ…å«é”™è¯¯ä¿¡æ¯å’Œå¯ç”¨è®¾å¤‡åˆ—è¡¨

### æ£€æŸ¥ä½ç½®

åœ¨ä»¥ä¸‹ä¸‰ä¸ªå…³é”®å‡½æ•°ä¸­æ·»åŠ äº†è®¾å¤‡æ£€æŸ¥ï¼š

1. **`check_and_start_emulator(emulator_name)`**
    - åœ¨å¯åŠ¨æ¨¡æ‹Ÿå™¨å‰æ£€æŸ¥
    - å¦‚æœæ£€æŸ¥å¤±è´¥ï¼Œè¿”å› `False`

2. **`handle_load_account_mode(account_name, emulator_name)`**
    - åœ¨åŠ è½½è´¦å·å‰æ£€æŸ¥
    - å¦‚æœæ£€æŸ¥å¤±è´¥ï¼Œè°ƒç”¨ `sys.exit(1)` é€€å‡º

3. **`initialize_device_and_ocr(emulator_name)`**
    - åœ¨åˆå§‹åŒ–è®¾å¤‡å‰æ£€æŸ¥
    - å¦‚æœæ£€æŸ¥å¤±è´¥ï¼ŒæŠ›å‡º `RuntimeError` å¼‚å¸¸

## ä½¿ç”¨ç¤ºä¾‹

### æ­£å¸¸ä½¿ç”¨ï¼ˆæ¨¡æ‹Ÿå™¨å­˜åœ¨ï¼‰

```bash
# æŒ‡å®šå­˜åœ¨çš„æ¨¡æ‹Ÿå™¨
uv run auto_dungeon.py --emulator emulator-5554

# è¾“å‡ºï¼š
# ğŸ“± è¿æ¥åˆ°æ¨¡æ‹Ÿå™¨: emulator-5554
# è¿æ¥å­—ç¬¦ä¸²: Android://127.0.0.1:5555/emulator-5554
# âœ… æˆåŠŸè¿æ¥åˆ°è®¾å¤‡
```

### é”™è¯¯ä½¿ç”¨ï¼ˆæ¨¡æ‹Ÿå™¨ä¸å­˜åœ¨ï¼‰

```bash
# æŒ‡å®šä¸å­˜åœ¨çš„æ¨¡æ‹Ÿå™¨
uv run auto_dungeon.py --emulator emulator-9999

# è¾“å‡ºï¼š
# âŒ æ¨¡æ‹Ÿå™¨ emulator-9999 ä¸åœ¨è®¾å¤‡åˆ—è¡¨ä¸­
# å¯ç”¨è®¾å¤‡: ['emulator-5554', 'emulator-5555']
# ğŸ“± å‘é€ Bark é€šçŸ¥: å‰¯æœ¬åŠ©æ‰‹ - é”™è¯¯
# âœ… Bark é€šçŸ¥å‘é€æˆåŠŸ
```

### æŸ¥çœ‹å¯ç”¨è®¾å¤‡

```bash
# è·å–æ‰€æœ‰å·²è¿æ¥çš„è®¾å¤‡
adb devices

# è¾“å‡ºç¤ºä¾‹ï¼š
# List of devices attached
# emulator-5554          device
# emulator-5555          device
```

## é…ç½® Bark é€šçŸ¥

### å¯ç”¨ Bark é€šçŸ¥

ç¼–è¾‘ `system_config.json`ï¼š

```json
{
    "bark": {
        "enabled": true,
        "server": "https://api.day.app/{device_key}/",
        "title": "å¼‚ä¸–ç•Œå‹‡è€… - å‰¯æœ¬åŠ©æ‰‹é€šçŸ¥",
        "group": "dungeon_helper"
    }
}
```

å°† `{device_key}` æ›¿æ¢ä¸ºä½ çš„ Bark è®¾å¤‡å¯†é’¥ã€‚

### ç¦ç”¨ Bark é€šçŸ¥

```json
{
    "bark": {
        "enabled": false
    }
}
```

## æµ‹è¯•

### è¿è¡Œå•å…ƒæµ‹è¯•

```bash
# è¿è¡Œæ‰€æœ‰è®¾å¤‡æ£€æŸ¥æµ‹è¯•
uv run python -m pytest tests/test_emulator_device_check.py -v

# è¿è¡Œç‰¹å®šæµ‹è¯•
uv run python -m pytest tests/test_emulator_device_check.py::TestEmulatorDeviceCheck::test_device_check_exists -v
```

### æµ‹è¯•è¦†ç›–

- âœ… æˆåŠŸè·å– ADB è®¾å¤‡åˆ—è¡¨
- âœ… å¤„ç†ç©ºè®¾å¤‡åˆ—è¡¨
- âœ… å¤„ç† ADB å‘½ä»¤æ‰§è¡Œå¤±è´¥
- âœ… æ£€æŸ¥å­˜åœ¨çš„è®¾å¤‡
- âœ… æ£€æŸ¥ä¸å­˜åœ¨çš„è®¾å¤‡
- âœ… å¤„ç†å¤šä¸ªè®¾å¤‡çš„æƒ…å†µ

## é”™è¯¯å¤„ç†

### å¸¸è§é”™è¯¯

| é”™è¯¯ä¿¡æ¯             | åŸå›                        | è§£å†³æ–¹æ¡ˆ                         |
| -------------------- | -------------------------- | -------------------------------- |
| æ¨¡æ‹Ÿå™¨ä¸åœ¨è®¾å¤‡åˆ—è¡¨ä¸­ | æŒ‡å®šçš„æ¨¡æ‹Ÿå™¨æœªå¯åŠ¨æˆ–ä¸å­˜åœ¨ | æ£€æŸ¥æ¨¡æ‹Ÿå™¨åç§°ï¼Œç¡®ä¿æ¨¡æ‹Ÿå™¨å·²å¯åŠ¨ |
| å¯ç”¨è®¾å¤‡ä¸ºç©º         | æ²¡æœ‰ä»»ä½•æ¨¡æ‹Ÿå™¨è¿æ¥         | å¯åŠ¨ BlueStacks æ¨¡æ‹Ÿå™¨           |
| ADB å‘½ä»¤æ‰§è¡Œå¤±è´¥     | ADB è¿æ¥é—®é¢˜               | æ£€æŸ¥ Android SDK å’Œ ADB é…ç½®     |

### è°ƒè¯•æŠ€å·§

1. **æŸ¥çœ‹å¯ç”¨è®¾å¤‡**

    ```bash
    adb devices
    ```

2. **æŸ¥çœ‹ Bark é€šçŸ¥æ—¥å¿—**
    - æ£€æŸ¥ `system_config.json` ä¸­çš„ Bark é…ç½®
    - ç¡®ä¿ `enabled` ä¸º `true`
    - ç¡®ä¿è®¾å¤‡å¯†é’¥æ­£ç¡®

3. **æŸ¥çœ‹è¯¦ç»†æ—¥å¿—**
    ```bash
    uv run auto_dungeon.py --emulator emulator-5554 2>&1 | tee debug.log
    ```

## ç›¸å…³æ–‡ä»¶

- `auto_dungeon.py` - ä¸»è„šæœ¬ï¼ŒåŒ…å«è®¾å¤‡æ£€æŸ¥é€»è¾‘
- `emulator_manager.py` - æ¨¡æ‹Ÿå™¨ç®¡ç†å™¨ï¼Œæä¾› `get_adb_devices()` æ–¹æ³•
- `tests/test_emulator_device_check.py` - å•å…ƒæµ‹è¯•
- `system_config.json` - ç³»ç»Ÿé…ç½®ï¼ŒåŒ…å« Bark é€šçŸ¥è®¾ç½®

## æ›´æ–°æ—¥å¿—

è¯¦è§ `CHANGELOG.md` ä¸­çš„ "[æ–°åŠŸèƒ½] æ·»åŠ æ¨¡æ‹Ÿå™¨è®¾å¤‡æ£€æŸ¥å’Œ Bark é€šçŸ¥" éƒ¨åˆ†ã€‚
