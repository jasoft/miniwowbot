# Daily Collect çœŸæœºæµ‹è¯•æ–‡æ¡£

## æ¦‚è¿°

æœ¬æ–‡æ¡£è¯´æ˜å¦‚ä½•è¿è¡Œ `daily_collect` å‡½æ•°çš„çœŸæœºæµ‹è¯•ã€‚

## æµ‹è¯•å†…å®¹

å·²åœ¨ [`tests/test_auto_dungeon_integration.py`](test_auto_dungeon_integration.py:285) ä¸­æ·»åŠ äº† `TestDailyCollectIntegration` æµ‹è¯•ç±»ï¼ŒåŒ…å«ä»¥ä¸‹æµ‹è¯•ç”¨ä¾‹ï¼š

### 1. `test_daily_collect_function_exists`
- **ç›®çš„**: éªŒè¯ `daily_collect` å‡½æ•°æ˜¯å¦å­˜åœ¨ä¸”å¯è°ƒç”¨
- **ç±»å‹**: å•å…ƒæµ‹è¯•
- **æ— éœ€è®¾å¤‡**: æ­¤æµ‹è¯•ä¸éœ€è¦çœŸæœºè¿æ¥

### 2. `test_daily_collect_real_device`
- **ç›®çš„**: æµ‹è¯• `daily_collect` å‡½æ•°åœ¨çœŸæœºä¸Šçš„åŸºæœ¬æ‰§è¡Œ
- **å‰ææ¡ä»¶**:
  - è®¾å¤‡å·²è¿æ¥
  - æ¸¸æˆå·²æ‰“å¼€å¹¶åœ¨ä¸»ç•Œé¢æˆ–ä»»æ„å¯è®¿é—®ä¸»ç•Œé¢çš„ç•Œé¢
- **æµ‹è¯•æ­¥éª¤**:
  1. è°ƒç”¨ [`daily_collect()`](../auto_dungeon.py:411) å‡½æ•°
  2. éªŒè¯å‡½æ•°èƒ½å¤Ÿæ­£å¸¸æ‰§è¡Œå®Œæˆï¼ˆä¸æŠ›å‡ºå¼‚å¸¸ï¼‰

### 3. `test_daily_collect_execution_time`
- **ç›®çš„**: éªŒè¯å‡½æ•°æ‰§è¡Œæ—¶é—´åœ¨åˆç†èŒƒå›´å†…
- **é¢„æœŸ**: æ‰§è¡Œæ—¶é—´åº”å°äº 60 ç§’
- **æµ‹è¯•å†…å®¹**: æµ‹é‡å‡½æ•°ä»å¼€å§‹åˆ°ç»“æŸçš„æ‰§è¡Œæ—¶é—´

### 4. `test_daily_collect_multiple_calls`
- **ç›®çš„**: æµ‹è¯•å‡½æ•°çš„ç¨³å®šæ€§å’Œå¹‚ç­‰æ€§
- **æµ‹è¯•å†…å®¹**: è¿ç»­è°ƒç”¨ 3 æ¬¡ `daily_collect` å‡½æ•°
- **é¢„æœŸ**: è‡³å°‘æœ‰ä¸€æ¬¡æˆåŠŸæ‰§è¡Œ
- **æ³¨æ„**: å¤šæ¬¡è°ƒç”¨åº”è¯¥èƒ½å¤Ÿæ­£å¸¸å¤„ç†"å·²é¢†å–"çš„æƒ…å†µ

### 5. `test_daily_collect_with_different_states`
- **ç›®çš„**: æµ‹è¯•åœ¨ä¸åŒæ¸¸æˆçŠ¶æ€ä¸‹è°ƒç”¨å‡½æ•°çš„è¡¨ç°
- **æµ‹è¯•å†…å®¹**:
  - ç¬¬ä¸€æ¬¡è°ƒç”¨ï¼ˆå¯èƒ½é¢†å–æˆåŠŸï¼‰
  - ç­‰å¾… 3 ç§’åç¬¬äºŒæ¬¡è°ƒç”¨ï¼ˆå¯èƒ½æ˜¾ç¤ºå·²é¢†å–ï¼‰
- **é¢„æœŸ**: å‡½æ•°åœ¨ä¸¤ç§çŠ¶æ€ä¸‹éƒ½èƒ½æ­£å¸¸æ‰§è¡Œ

## è¿è¡Œæµ‹è¯•

### æ–¹æ³• 1: ä½¿ç”¨ä¾¿æ·è„šæœ¬ï¼ˆæ¨èï¼‰

```bash
# è¿è¡Œ daily_collect ä¸“é¡¹æµ‹è¯•
./test_daily_collect.sh
```

è¿™ä¸ªè„šæœ¬ä¼šï¼š
1. æ£€æŸ¥è®¾å¤‡è¿æ¥çŠ¶æ€
2. è¯¢é—®æ˜¯å¦ç»§ç»­
3. è¿è¡Œæ‰€æœ‰ `daily_collect` ç›¸å…³æµ‹è¯•
4. æ˜¾ç¤ºè¯¦ç»†çš„æµ‹è¯•ç»“æœ

### æ–¹æ³• 2: ç›´æ¥ä½¿ç”¨ pytest

```bash
# è¿è¡Œæ‰€æœ‰ daily_collect æµ‹è¯•
pytest tests/test_auto_dungeon_integration.py::TestDailyCollectIntegration -v -s

# è¿è¡Œå•ä¸ªæµ‹è¯•
pytest tests/test_auto_dungeon_integration.py::TestDailyCollectIntegration::test_daily_collect_real_device -v -s

# è¿è¡Œæ‰€æœ‰é›†æˆæµ‹è¯•
pytest tests/test_auto_dungeon_integration.py -v -s --tb=short
```

### æ–¹æ³• 3: ç›´æ¥è¿è¡Œæµ‹è¯•æ–‡ä»¶

```bash
python tests/test_auto_dungeon_integration.py
```

## å‰ç½®æ¡ä»¶

### 1. è®¾å¤‡å‡†å¤‡
```bash
# æ£€æŸ¥è®¾å¤‡è¿æ¥
adb devices

# åº”è¯¥çœ‹åˆ°ç±»ä¼¼è¾“å‡ºï¼š
# List of devices attached
# emulator-5554   device
```

### 2. æ¸¸æˆçŠ¶æ€
- æ¸¸æˆåº”è¯¥å·²ç»æ‰“å¼€
- å»ºè®®åœ¨ä¸»ç•Œé¢è¿è¡Œæµ‹è¯•
- è§’è‰²å·²é€‰æ‹©å®Œæˆ

### 3. ç¯å¢ƒå‡†å¤‡
```bash
# å®‰è£…ä¾èµ–ï¼ˆå¦‚æœè¿˜æ²¡å®‰è£…ï¼‰
pip install pytest airtest-selenium poco
```

## daily_collect å‡½æ•°è¯´æ˜

[`daily_collect()`](../auto_dungeon.py:411) å‡½æ•°çš„ä¸»è¦åŠŸèƒ½ï¼š

1. è¿”å›ä¸»ç•Œé¢ (`back_to_main`)
2. åœ¨åŒºåŸŸ 8 æŸ¥æ‰¾å¹¶ç‚¹å‡»"æˆ˜æ–—"æ–‡æœ¬
3. ç‚¹å‡»ç®±å­ä½ç½®ï¼ˆæˆ˜æ–—æŒ‰é’®ä¸Šæ–¹ 50 åƒç´ ï¼‰
4. ç‚¹å‡»"æ”¶ä¸‹"æŒ‰é’®
5. ç‚¹å‡»"ç¡®å®š"æŒ‰é’®
6. è®°å½•é¢†å–ç»“æœ

**ä½ç½®**: [`auto_dungeon.py:411-423`](../auto_dungeon.py:411)

## æµ‹è¯•ç»“æœè§£è¯»

### æˆåŠŸçš„æµ‹è¯•è¾“å‡ºç¤ºä¾‹
```
tests/test_auto_dungeon_integration.py::TestDailyCollectIntegration::test_daily_collect_real_device
ğŸ§ª å¼€å§‹æµ‹è¯•æ¯æ—¥é¢†å–åŠŸèƒ½
âœ… é¢†å–æˆåŠŸ
âœ… daily_collect å‡½æ•°æ‰§è¡ŒæˆåŠŸ
PASSED

tests/test_auto_dungeon_integration.py::TestDailyCollectIntegration::test_daily_collect_execution_time
ğŸ§ª å¼€å§‹æµ‹è¯•æ¯æ—¥é¢†å–åŠŸèƒ½æ‰§è¡Œæ—¶é—´
âœ… é¢†å–æˆåŠŸ
â±ï¸ daily_collect æ‰§è¡Œæ—¶é—´: 12.34 ç§’
PASSED

tests/test_auto_dungeon_integration.py::TestDailyCollectIntegration::test_daily_collect_multiple_calls
ğŸ”„ ç¬¬ 1 æ¬¡è°ƒç”¨ daily_collect
âœ… é¢†å–æˆåŠŸ
âœ… ç¬¬ 1 æ¬¡è°ƒç”¨æˆåŠŸ
ğŸ”„ ç¬¬ 2 æ¬¡è°ƒç”¨ daily_collect
âš ï¸ æœªæ‰¾åˆ°é¢†å–æŒ‰é’®
âœ… ç¬¬ 2 æ¬¡è°ƒç”¨æˆåŠŸ
ğŸ”„ ç¬¬ 3 æ¬¡è°ƒç”¨ daily_collect
âš ï¸ æœªæ‰¾åˆ°é¢†å–æŒ‰é’®
âœ… ç¬¬ 3 æ¬¡è°ƒç”¨æˆåŠŸ
ğŸ“Š daily_collect æˆåŠŸç‡: 3/3
PASSED
```

### å¸¸è§é—®é¢˜

#### 1. "æœªæ‰¾åˆ°é¢†å–æŒ‰é’®"
è¿™æ˜¯æ­£å¸¸çš„ï¼Œå¯èƒ½çš„åŸå› ï¼š
- å¥–åŠ±å·²ç»è¢«é¢†å–è¿‡
- å½“å‰ä¸åœ¨æ­£ç¡®çš„ç•Œé¢
- OCR è¯†åˆ«å¤±è´¥

**ä¸å½±å“æµ‹è¯•**: å‡½æ•°åº”è¯¥èƒ½å¤Ÿæ­£å¸¸å¤„ç†è¿™ç§æƒ…å†µ

#### 2. è®¾å¤‡è¿æ¥å¤±è´¥
```
âŒ è®¾å¤‡è¿æ¥å¤±è´¥: ...
```

**è§£å†³æ–¹æ¡ˆ**:
- ç¡®ä¿æ¨¡æ‹Ÿå™¨/è®¾å¤‡å·²å¯åŠ¨
- è¿è¡Œ `adb devices` æ£€æŸ¥è¿æ¥
- é‡å¯ ADB: `adb kill-server && adb start-server`

#### 3. æµ‹è¯•è¶…æ—¶
```
pytest.fail(f"å‡½æ•°æ‰§è¡Œæ—¶é—´è¿‡é•¿: XX.XX ç§’")
```

**å¯èƒ½åŸå› **:
- ç½‘ç»œå»¶è¿Ÿ
- æ¸¸æˆå“åº”æ…¢
- ç•Œé¢å¡ä½

**è§£å†³æ–¹æ¡ˆ**:
- æ£€æŸ¥æ¸¸æˆçŠ¶æ€
- æ‰‹åŠ¨è¿”å›ä¸»ç•Œé¢åé‡è¯•
- å¢åŠ è¶…æ—¶æ—¶é—´ï¼ˆä¿®æ”¹æµ‹è¯•ä»£ç ä¸­çš„ 60 ç§’é™åˆ¶ï¼‰

## æµ‹è¯•æœ€ä½³å®è·µ

1. **æµ‹è¯•å‰å‡†å¤‡**
   - ç¡®ä¿æ¸¸æˆåœ¨ä¸»ç•Œé¢
   - ç¡®ä¿ç½‘ç»œè¿æ¥ç¨³å®š
   - å…³é—­å…¶ä»–å¯èƒ½å¹²æ‰°çš„åº”ç”¨

2. **æµ‹è¯•é¡ºåº**
   - å»ºè®®å…ˆè¿è¡Œ `test_daily_collect_function_exists`
   - å†è¿è¡Œ `test_daily_collect_real_device`
   - æœ€åè¿è¡Œå…¶ä»–æµ‹è¯•

3. **æµ‹è¯•é¢‘ç‡**
   - æ¯æ¬¡ä¿®æ”¹ `daily_collect` å‡½æ•°åè¿è¡Œæµ‹è¯•
   - å®šæœŸè¿è¡Œä»¥ç¡®ä¿åŠŸèƒ½ç¨³å®šæ€§
   - åœ¨ä¸åŒæ¸¸æˆçŠ¶æ€ä¸‹æµ‹è¯•

4. **è°ƒè¯•æŠ€å·§**
   - ä½¿ç”¨ `-v -s` å‚æ•°æŸ¥çœ‹è¯¦ç»†è¾“å‡º
   - ä½¿ç”¨ `--tb=short` æŸ¥çœ‹ç®€åŒ–çš„é”™è¯¯è¿½è¸ª
   - å•ç‹¬è¿è¡Œå¤±è´¥çš„æµ‹è¯•ç”¨ä¾‹è¿›è¡Œè°ƒè¯•

## ç›¸å…³æ–‡ä»¶

- æµ‹è¯•æ–‡ä»¶: [`tests/test_auto_dungeon_integration.py`](test_auto_dungeon_integration.py:1)
- è¢«æµ‹å‡½æ•°: [`auto_dungeon.py:411-423`](../auto_dungeon.py:411)
- ä¾¿æ·è„šæœ¬: [`test_daily_collect.sh`](../test_daily_collect.sh:1)
- å…¶ä»–é›†æˆæµ‹è¯•: åˆ‡æ¢è´¦å·æµ‹è¯•ã€é€‰æ‹©è§’è‰²æµ‹è¯•

## æ‰©å±•æµ‹è¯•

å¦‚æœéœ€è¦æ·»åŠ æ›´å¤šæµ‹è¯•åœºæ™¯ï¼Œå¯ä»¥åœ¨ `TestDailyCollectIntegration` ç±»ä¸­æ·»åŠ æ–°çš„æµ‹è¯•æ–¹æ³•ï¼š

```python
def test_daily_collect_custom_scenario(self, setup_device):
    """è‡ªå®šä¹‰æµ‹è¯•åœºæ™¯"""
    # ä½ çš„æµ‹è¯•ä»£ç 
    pass
```

## åé¦ˆä¸æ”¹è¿›

å¦‚æœå‘ç°æµ‹è¯•é—®é¢˜æˆ–éœ€è¦æ·»åŠ æ–°çš„æµ‹è¯•åœºæ™¯ï¼Œè¯·ï¼š
1. è®°å½•è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯
2. è¯´æ˜æ¸¸æˆå½“å‰çŠ¶æ€
3. æä¾›è®¾å¤‡/æ¨¡æ‹Ÿå™¨ä¿¡æ¯
4. å»ºè®®æ”¹è¿›æ–¹æ¡ˆ
